// 1. GENERATOR
generator client {
  provider = "prisma-client-js"
}

// 2. DATASOURCE (Supabase)
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- ENUMS ---

enum TaskStatus {
  NEW
  BACKLOG
  IN_PROGRESS
  DONE
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// --- MODELS ---

// The Agency Owner (You)
model User {
  id         String   @id // Supabase Auth ID (UUID)
  email      String   @unique
  name       String?
  avatarUrl  String?
  agencyName String?

  // Relationships
  clients Client[] // You manage multiple Clients
  tasks   Task[]   // Tasks assigned to/created by you

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// The Company paying you (e.g., "Acme Corp")
model Client {
  id     String  @id @default(cuid())
  name   String
  logo   String? // URL to client logo
  email  String? // Contact person email

  // Belongs to an Agency User
  userId String
  // ðŸ‘‡ If User is deleted, delete their Clients
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Has many Projects
  projects Project[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// The Specific Contract (e.g., "Website Redesign")
model Project {
  id     String @id @default(cuid())
  name   String
  status String @default("ACTIVE") // ACTIVE, ARCHIVED, COMPLETED

  // Belongs to a Client
  clientId String
  // ðŸ‘‡ CRITICAL: If Client is deleted, delete this Project
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  // Has many Tasks
  tasks Task[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// The Unit of Work (e.g., "Design Home Page")
model Task {
  id          String     @id @default(uuid())
  readableId  Int        @unique @default(autoincrement()) // OPS-101
  title       String
  description String?    @db.Text
  status      TaskStatus @default(NEW)
  priority    Priority   @default(MEDIUM)
  isMilestone Boolean    @default(false)
  position    Float      @default(0) // For Drag & Drop sorting
  dueDate     DateTime?
  labels      String[]   // Keeping this for flexibility

  // Relationships
  userId String // Assigned User
  user   User   @relation(fields: [userId], references: [id])

  projectId String? // Linked Project (Optional for generic tasks)
  // ðŸ‘‡ CRITICAL: If Project is deleted, delete this Task
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Indexes for faster dashboard loading
  @@index([userId])
  @@index([projectId])
}